/// <reference types="cypress" />
// ***********************************************************
// This example plugins/index.js can be used to load plugins
//
// You can change the location of this file or turn off loading
// the plugins file with the 'pluginsFile' configuration option.
//
// You can read more here:
// https://on.cypress.io/plugins-guide
// ***********************************************************

//used for the db tasks
const db = require("mysql2/promise").createPool({
  host: "localhost",
  port: "3307",
  user: "p396wpuser",
  password: "p396wppass",
  database: "p396wpdb",
});

const options_empty = "a:0:{}";
// To create the options, complete the wizard, copy the content of
// `eidlogin_options` from the db to a file and issue the following command to
// remove all line breaks from the certificates in Vim:
// :%s/.\+\zs\n\ze./ /
const options_default =
	'a:13:{s:9:"activated";s:4:"true";s:12:"sp_entity_id";s:25:"https://wordpress.p396.de";s:14:"sp_enforce_enc";s:5:"false";s:13:"idp_entity_id";s:46:"https://service.skidentity.de/fs/saml/metadata";s:11:"idp_sso_url";s:49:"https://service.skidentity.de/fs/saml/remoteauth/";s:13:"idp_cert_sign";s:1916:"MIIFlzCCA3+gAwIBAgIIUxbcS/Bb6QcwDQYJKoZIhvcNAQELBQAwYzELMAkGA1UEBhMCREUxDzANBgNVBAgTBkJheWVybjERMA8GA1UEBxMITWljaGVsYXUxEzARBgNVBAoTCmVjc2VjIEdtYkgxGzAZBgNVBAMTElNrSURlbnRpdHkgU0FNTCBGUzAeFw0yMDAxMTMxMDAwMDBaFw0yMjAxMTMxMDAwMDBaMGMxCzAJBgNVBAYTAkRFMQ8wDQYDVQQIEwZCYXllcm4xETAPBgNVBAcTCE1pY2hlbGF1MRMwEQYDVQQKEwplY3NlYyBHbWJIMRswGQYDVQQDExJTa0lEZW50aXR5IFNBTUwgRlMwggIiMA0GCSqGSIb3DQEBAQUAA4ICDwAwggIKAoICAQCgSraq4/BaSD+8tPKKsez/Uk6FZ2c4cxSzjvcZptVPo7IH2cdLRKnlVfVgLPoeV+MOL/viu1y6IPp6aEJ09vl/7V0P5oEZ9BJ41K6DVsBb/puiFOC/Ma6Q53DbHbZQJJdGPmX1RH297e420iYs19zH7Y98X+ZTVOlOIxc26/yubc6XiMPvGzIv5BsHYzfyLFdapV/PTj21BDUmhas/H83zJP1IGdurJOt8/u7T1Mg2haLlU+Vp1xdeSaZgk+iesRyIB3Y774s6jqavxkit9PHk+Qq166sW2NOQLtb/BR/1aVK5rvvQqrZ0cLnk2jCFyDht4kZ7O6T5C0seQXDOGKHacv6neqfLu+4lWOTpZk/ANrbd8d2oG98k8lc5j2agVC7PjM0lTRoEMedTfG7J4q4mgSKhlL+YrRhIb/nYUSScn0EiAr32YSb5caboT3+eiqXnzAqVbH/wtwXIpbTkgQEwlk6A/TkDhv9+ssDv75k4PUKWmFjUKrC/TUQmC5k8TXvO40NX2cGOVimTavN1fSe1Pj1ytmQXRrbfrKiNwz+EbhAJHTdkEHh40XwjJh2jvwSSctvs3vpVIAtX4FPtHTOraBCZyyH0X/1vtKRruY2VzO8kAeU2Zb4NWE2STmFSXbIG9Pyci9eqdtd5nr3GaPj4g8BabcmMweOJRWwqm8F3fwIDAQABo08wTTAdBgNVHQ4EFgQUPSTV0I2z0mB0eJ/2JPvLPb4UVxswHwYDVR0jBBgwFoAUPSTV0I2z0mB0eJ/2JPvLPb4UVxswCwYDVR0PBAQDAgSQMA0GCSqGSIb3DQEBCwUAA4ICAQCbquW0L2qylIajQ0IelyVQhhAQPc2Eu8ZYequg2OGWHD/LnMyQxEX7eCiIEXTy92+B1Yw9BWVPQo2LvIgzwNAOFaepbdZJCa9CfuI5BEJUlX4QlGZWMfoFIhT08//Z1op+ru4FeQEZwH6fVJqotTnxkpmjbAOMrC5UVpADqBoIoRdS0IaWjW2mN6Gt9G0priQxmgV3FC8n4dhYUgyndOG9ImYkgxtRwHGnk0SC/N6b3PMZxAccxDKBfY0vxAsg3Hktshc5LF2OW08o9Uji/w6OHvSL4uYVGkPOot6u1wncKsz8bQyt7Sj+Tx3nNdqjNciZsd11i9YlIlI0DmLCb4cq61P1AAAZY4d9ah0NdfWLNBUdeER4qnOahdwJXQXdMGkc4FNF4gx7gczGG4vrMKHgn8v2jxEuAhNHVbBGSi0JwO/eK/p8nFW8y/3SgXIWhL+efS4DWYcYhVKU7izAgj0fnnF/flUkaJjTH+rSgzQK/QISYplzSGPa0+bri/kxvxx1Q1VwPI1hpFAS/o9pFuANlNeBD6x26HZYJPK7Leg9/sQ+IAgkS8KR+GInyaZ285A1QNmBy7MmVU304WM6fiZ9+Osbi7n7aK6+BFbKFnhnVRTp4C7Vp3xCXut6z62q0BuxfiHvrYgA5X2HxPRuTjb+beHkiLq7VOb9AW8cPI4wHw==";s:12:"idp_cert_enc";s:1916:"MIIFlzCCA3+gAwIBAgIIUxbcS/Bb6QcwDQYJKoZIhvcNAQELBQAwYzELMAkGA1UEBhMCREUxDzANBgNVBAgTBkJheWVybjERMA8GA1UEBxMITWljaGVsYXUxEzARBgNVBAoTCmVjc2VjIEdtYkgxGzAZBgNVBAMTElNrSURlbnRpdHkgU0FNTCBGUzAeFw0yMDAxMTMxMDAwMDBaFw0yMjAxMTMxMDAwMDBaMGMxCzAJBgNVBAYTAkRFMQ8wDQYDVQQIEwZCYXllcm4xETAPBgNVBAcTCE1pY2hlbGF1MRMwEQYDVQQKEwplY3NlYyBHbWJIMRswGQYDVQQDExJTa0lEZW50aXR5IFNBTUwgRlMwggIiMA0GCSqGSIb3DQEBAQUAA4ICDwAwggIKAoICAQCgSraq4/BaSD+8tPKKsez/Uk6FZ2c4cxSzjvcZptVPo7IH2cdLRKnlVfVgLPoeV+MOL/viu1y6IPp6aEJ09vl/7V0P5oEZ9BJ41K6DVsBb/puiFOC/Ma6Q53DbHbZQJJdGPmX1RH297e420iYs19zH7Y98X+ZTVOlOIxc26/yubc6XiMPvGzIv5BsHYzfyLFdapV/PTj21BDUmhas/H83zJP1IGdurJOt8/u7T1Mg2haLlU+Vp1xdeSaZgk+iesRyIB3Y774s6jqavxkit9PHk+Qq166sW2NOQLtb/BR/1aVK5rvvQqrZ0cLnk2jCFyDht4kZ7O6T5C0seQXDOGKHacv6neqfLu+4lWOTpZk/ANrbd8d2oG98k8lc5j2agVC7PjM0lTRoEMedTfG7J4q4mgSKhlL+YrRhIb/nYUSScn0EiAr32YSb5caboT3+eiqXnzAqVbH/wtwXIpbTkgQEwlk6A/TkDhv9+ssDv75k4PUKWmFjUKrC/TUQmC5k8TXvO40NX2cGOVimTavN1fSe1Pj1ytmQXRrbfrKiNwz+EbhAJHTdkEHh40XwjJh2jvwSSctvs3vpVIAtX4FPtHTOraBCZyyH0X/1vtKRruY2VzO8kAeU2Zb4NWE2STmFSXbIG9Pyci9eqdtd5nr3GaPj4g8BabcmMweOJRWwqm8F3fwIDAQABo08wTTAdBgNVHQ4EFgQUPSTV0I2z0mB0eJ/2JPvLPb4UVxswHwYDVR0jBBgwFoAUPSTV0I2z0mB0eJ/2JPvLPb4UVxswCwYDVR0PBAQDAgSQMA0GCSqGSIb3DQEBCwUAA4ICAQCbquW0L2qylIajQ0IelyVQhhAQPc2Eu8ZYequg2OGWHD/LnMyQxEX7eCiIEXTy92+B1Yw9BWVPQo2LvIgzwNAOFaepbdZJCa9CfuI5BEJUlX4QlGZWMfoFIhT08//Z1op+ru4FeQEZwH6fVJqotTnxkpmjbAOMrC5UVpADqBoIoRdS0IaWjW2mN6Gt9G0priQxmgV3FC8n4dhYUgyndOG9ImYkgxtRwHGnk0SC/N6b3PMZxAccxDKBfY0vxAsg3Hktshc5LF2OW08o9Uji/w6OHvSL4uYVGkPOot6u1wncKsz8bQyt7Sj+Tx3nNdqjNciZsd11i9YlIlI0DmLCb4cq61P1AAAZY4d9ah0NdfWLNBUdeER4qnOahdwJXQXdMGkc4FNF4gx7gczGG4vrMKHgn8v2jxEuAhNHVbBGSi0JwO/eK/p8nFW8y/3SgXIWhL+efS4DWYcYhVKU7izAgj0fnnF/flUkaJjTH+rSgzQK/QISYplzSGPa0+bri/kxvxx1Q1VwPI1hpFAS/o9pFuANlNeBD6x26HZYJPK7Leg9/sQ+IAgkS8KR+GInyaZ285A1QNmBy7MmVU304WM6fiZ9+Osbi7n7aK6+BFbKFnhnVRTp4C7Vp3xCXut6z62q0BuxfiHvrYgA5X2HxPRuTjb+beHkiLq7VOb9AW8cPI4wHw==";s:15:"idp_ext_tr03130";s:0:"";s:10:"eid_delete";s:5:"false";s:10:"sp_key_act";s:1704:"-----BEGIN PRIVATE KEY----- MIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQCzBtN7uo9RmEvi HfFDrink93WLUg2sgBj7uHEj2cJEqmUQc24wcywCpYLHr6Lc2JWsqg/d9rQaLlF0 O3A2Bjero1txiyP8tUUtffpXsQ/rKwJ50h/8bLGd7C6+kBFN/gZjsY6wOoYg5ttO s8zKKpEKoGwfCCaGRha6fax8P58GeTd5aW54YcGNHfZeY3J5GC5tLoGbYERSHZtn 5S8aRnfoUXfvZohrhZburXJDHGVD6s8CTvXIDGCd/W0xOC5g8ePBDs8Jg78ryOwb BrnRV7rrU4vaQvJojh7NY7z46647E6YwQ/yp5h7IPdnyP/HucIRHs7TJ4L86KFTa lcIhIlS1AgMBAAECggEAGAAoRgQixpuWQMAm4h3tO+b4+S6M6r1ZnBWEBXxiEPaP Cf+PnCs0kT5DJCYlvVnD5xv9eJJkXsYq4Vw+lN+MgxQpZDV1I6HhnlGvSCZSrgJc GJzU8PBZd4R8V8vUphISJTdem72c0bhhWlG8eLXwL+6F0Ds1fvbSgTnr79RPq3xH Jy/JXY5Ezr/Djsrq5vOEcFfNancucnWtlkBfYP13GdsvRHpR1NTb1WEdEy+nZ/bT M9e+HZbCsTqrt3r4jAgyjJx9PCD6/gwE+MXnhzjilnN5cpf4lkUK+xrS6NcN2yqC SrvAthODj4Gmr3HNvpZoQlEubD+JV243/jnV8JDzmQKBgQDmavnmYMfpE/JBkMgK T3doofCgLe1iwA09F5Dv4ck0A6hrUV6lsyt/vhzGrpg8isBuCDXLG09ow8pfy4d/ 89WLldOnJg6HPmoLG0hx3T+hJcc7XSGRxFzJT14uquh6+S9scYABjv9qYarwSAoX RcQbAzOR1Z5sO8ZRgFk4LpShawKBgQDG5zCFUG3lYW+0JVrKEVC4oMCn2DC2hCH3 SVZbCUMpsH8PEx3Jr9Lf0myVxtgdi7RlrX9/e9H/QOXPny/k001z8Te424a5905b hvkSP/Sd9SgVzepy0OZqLOjEkW/rksQS5ey7H+f/T96p/0bk2HREpmsFBITTz3wU H2JarNTKXwKBgGTpaPSqYiMD508rt1A8qVEbyyR7uMFM1v9weLt2KQYsq/AEPO1Y 4K4bdsLU6DtrkQcfdV+0YDzDsrftjTROd7GgNoe3tRkqDos6samceid7QhwPl4od c31+0wKhOxvQUiKuOp90HwxaJeEBy9mRZmdmKYmvAqjoLNy411oxnEptAoGAT2qJ lgEaD+cKibwMdvfY6g7NPXb1ZDp3sVunzitxlJiy8proXtoD8Xf8AQVmzs00FxDi Ak22+Bq6Z16g6dVwbGWYoQeN0Hys3aCTnDTK/7Kd8a7I+FTuWuBZg/qp3D46aW1C SyifIfKK7gdOEBtYuPxVaKh4PHXwjbxGMfwl7jMCgYEAo2mLGAZoOvfDVngMr77g vAX6K10PV7f06XbU0aQHsmdnd4eeVe7+FuJYjztAo15/sC5MagNT/FAq4amwJtuW EkKhdB1sgTnym9Fm1eILf4N0mTacrOdH8xc5GshuGIegZtGPVne5KdgDff9OHYl6 6UJM1YvwHSVwLiaBM9IZb8c= -----END PRIVATE KEY----- ";s:11:"sp_cert_act";s:1200:"-----BEGIN CERTIFICATE----- MIIDSTCCAjGgAwIBAgIEYNGmkDANBgkqhkiG9w0BAQsFADA3MTUwMwYDVQQDDCx3 b3JkcHJlc3MucDM5Ni5kZSBXb3JkUHJlc3MgZUlELUxvZ2luIFBsdWdpbjAeFw0y MTA2MjIwOTAwMDBaFw0yMzA2MjIwOTAwMDBaMDcxNTAzBgNVBAMMLHdvcmRwcmVz cy5wMzk2LmRlIFdvcmRQcmVzcyBlSUQtTG9naW4gUGx1Z2luMIIBIjANBgkqhkiG 9w0BAQEFAAOCAQ8AMIIBCgKCAQEAswbTe7qPUZhL4h3xQ64p5Pd1i1INrIAY+7hx I9nCRKplEHNuMHMsAqWCx6+i3NiVrKoP3fa0Gi5RdDtwNgY3q6NbcYsj/LVFLX36 V7EP6ysCedIf/GyxnewuvpARTf4GY7GOsDqGIObbTrPMyiqRCqBsHwgmhkYWun2s fD+fBnk3eWlueGHBjR32XmNyeRgubS6Bm2BEUh2bZ+UvGkZ36FF372aIa4WW7q1y QxxlQ+rPAk71yAxgnf1tMTguYPHjwQ7PCYO/K8jsGwa50Ve661OL2kLyaI4ezWO8 +OuuOxOmMEP8qeYeyD3Z8j/x7nCER7O0yeC/OihU2pXCISJUtQIDAQABo10wWzAd BgNVHQ4EFgQUFZI5pm3w5gnEvmv0dzgiqtxB2fEwHwYDVR0jBBgwFoAUFZI5pm3w 5gnEvmv0dzgiqtxB2fEwDAYDVR0TAQH/BAIwADALBgNVHQ8EBAMCBaAwDQYJKoZI hvcNAQELBQADggEBAI/5IVX88Y8pjSxzHi6FBz2BTrBF/znGQO9UQ2K98iS/vKTn jDTfsoqACwjgsZFtW9bEFQqHE/6XZt4C2gH5ezjeTmOAIoKRa4UGm2eSJ7VAY+Kc rcOMEAW04mvsZf26kJFezfO+AKr4MQS7XD8c3XbYkZgQ68P6RC4TqaOwYLWFpXS0 Yq4haMVv04PpdV2kYmZiGSoTipW7V1AyEevF8/yMTY20wDxfrsVD8Juq9/nWm0W4 myeXcdDg85d6f/+E1N+os7XVrOBUNf1CHQAcVB+H2E80aFrFIzgkPHoM8pvfavhx XjlVH3vcxPGglzxYk+4KrbVKbo1lteomgvE8KoU= -----END CERTIFICATE----- ";s:14:"sp_key_act_enc";s:1704:"-----BEGIN PRIVATE KEY----- MIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQDRNLTgPkcote9i vJpggGJvmgbFbgQXArNTqdc6MiDQsqrH9c7f8gY0vGHb2ESAZxGAhYjisnPmwa7y wCtr7xvIw+WPfP1Dp7iML39iY8kLX5b7pLomrTATITLSj7ROVRnbCOW8xTIjrWeP HiG9m72jkZekIL9XldodMZTkw2V9se53ZMX8Gb6N7P9TrFW6fmkELe2+6/azhsHW AXpkbWN0g+DJhcLrZQFCm9LKOasztb79JKAOz8Uy7uQFzTRp6zeT+uRbEhUkQ1jZ jJo9n2ykCdBi80epfeGTN0d66Sc2jQJ9aSjmKpaohpkYTq7AQpwVoPW7qsDZNFG6 LtkWQcM7AgMBAAECggEAc4c2p2rc4vdtZcofOlFLirO1L4usiIR+QSJWb5XFF1rD Ar+UaYj+slqhc8U/NuUz/hQ/3miLpo+oq/dBQ058umaru4xbU+Qn/oowP0Y5fKVh /D8gaUFUfgvkQ/EFsgg+yf1k2NTQ9nDI8njCSzHZDJ3W7tUCtTxUgbCit53Lyxfa kDfRktG4w2rqm7SIJSh0qbOChX13G7N6VjcZOkg/VtUzbQutcrTp6f4BkVCQ4Eev 39W0zri/3kmVoqPQgSdfLYaTNBeZU5zPnwfXnffU3WUftACrOxCsZIPp5syjqSRo 39iekn7seP1mrjfc24m2xjFTLPebi+Y8N13238ao+QKBgQDui/9kY/mPxyjr3t7p jYVwOLtxblurU1siLdYFuEITJXzJ7B+Zt1EoLmVh0TopizBdC+IW+xmRtKZ2DK9o 32GpGj0MVq5oc2TUVOxqQsidv3y/fttX3tZT5hb1W5kRf9OInQeQGtzLDuxBFKsu ItvG+aXEVjEXX/rvNwNn/SvkrQKBgQDggyZiqGgx2jpErxoWTCmsuzu8CJU94MrS SOKxmgd3rDClEDU3IOtyQ94xxJbGD5fhAGENrOLd3DlVyXVfQH3wexK6jQuXZA5j 1tiET/sKTVxB8DU6C33bxjw8vawffbJhk7FrVNifJKYxw1JjnD6hjsVGh7ogguGS krdVlWZchwKBgQDgPQ34qtofw9G92CWnWneDRHE/ccQOSy8x8/BqNAk4wlaJ4cLa 1q4dnW+EAhAwmTz/WnpPq/8fLrgD5GzHoqTFN3sHrDwKx96SkroiMWEwmJ6FzJQY B8tl1rbiMhazknugwiwn1HiVERQZIXrAxdffNTIUXAmNtZXHZOl4yU6HiQKBgQCC P/QUBom0aluln0RuLS98U397Pit/I5vnVXuW97pfVlk+WeHVotaViwQsMVYbf85o LbUgnu1bMzlcKK1cXmjyDCS4b72KzfR/PZSNZm1I88qTQo1OqH4S87Xcs1lZR64m Z+3lS+sEoNl+Q0fYHDxFtDOFEJcN54CAbXfJQgyJnwKBgGH4jENwVwuXYLYCawzJ H9dXhpdatqdyVsr8TEnesxsqmKRLgqeD/2ipbj+uxleGaglNjrKzTt1dUCcB7gyZ ky118E2/UH3Q+YZYNh2UyeAIYrZFpJbyaen7KDP7hVAf0ea4YCpjVJ4A4oYVjAfS jJDQrPYAzN9buMoKKFXnb/Wt -----END PRIVATE KEY----- ";s:15:"sp_cert_act_enc";s:1200:"-----BEGIN CERTIFICATE----- MIIDSTCCAjGgAwIBAgIEYNGmkDANBgkqhkiG9w0BAQsFADA3MTUwMwYDVQQDDCx3 b3JkcHJlc3MucDM5Ni5kZSBXb3JkUHJlc3MgZUlELUxvZ2luIFBsdWdpbjAeFw0y MTA2MjIwOTAwMDBaFw0yMzA2MjIwOTAwMDBaMDcxNTAzBgNVBAMMLHdvcmRwcmVz cy5wMzk2LmRlIFdvcmRQcmVzcyBlSUQtTG9naW4gUGx1Z2luMIIBIjANBgkqhkiG 9w0BAQEFAAOCAQ8AMIIBCgKCAQEA0TS04D5HKLXvYryaYIBib5oGxW4EFwKzU6nX OjIg0LKqx/XO3/IGNLxh29hEgGcRgIWI4rJz5sGu8sAra+8byMPlj3z9Q6e4jC9/ YmPJC1+W+6S6Jq0wEyEy0o+0TlUZ2wjlvMUyI61njx4hvZu9o5GXpCC/V5XaHTGU 5MNlfbHud2TF/Bm+jez/U6xVun5pBC3tvuv2s4bB1gF6ZG1jdIPgyYXC62UBQpvS yjmrM7W+/SSgDs/FMu7kBc00aes3k/rkWxIVJENY2YyaPZ9spAnQYvNHqX3hkzdH euknNo0CfWko5iqWqIaZGE6uwEKcFaD1u6rA2TRRui7ZFkHDOwIDAQABo10wWzAd BgNVHQ4EFgQUecTxL+cthFfCVvkRqzJaZvKa4ygwHwYDVR0jBBgwFoAUecTxL+ct hFfCVvkRqzJaZvKa4ygwDAYDVR0TAQH/BAIwADALBgNVHQ8EBAMCBaAwDQYJKoZI hvcNAQELBQADggEBALHDmfsKF4oAUg+uIdnzBfiNh1HssJEUd05QC6fTKGnJdr8V CMd9pXgdLLVlTfl925PxlPPec45iYqwIxcO76h0r+HnO4WFPgWcHFfCpFwrDdTfE Ihvy+NeaRulyGePXkVigZ9CdfIYmSbT+ANpk/iN/bqeqyfwiSjnFOLTMlUF3NZWF Y7qGA6p6C49xkm0pkZmSVmzEgkp61HzVhpcp/mhQ/yB+ey/dFiVzCcpSPhXLAWVs hkenmdgceLw5PpOs3zCcGSz3QC6Hlnt+FvJW6orqGzYn/74i9r7HcSHG/292qwg2 l5iczey7R3okFehxZJOaEwVjN2bB82tD2PYrIy0= -----END CERTIFICATE----- ";}';

// This function is called when a project is opened or re-opened (e.g. due to
// the project's config changing)

/**
 * @type {Cypress.PluginConfig}
 */
module.exports = (on, config) => {
  // `on` is used to hook into various events Cypress emits
  // `config` is the resolved Cypress config

  on("task", {
    async "db:sql"(options) {
      const rs = await db.query(options.sql, options.params);
      return rs;
    },
    async "db:modify_options"(action) {
      let optionName = "eidlogin_options";
      let options = action == "clear" ? options_empty : options_default;

      let sql = "INSERT INTO wp_options (option_name, option_value) ";
      sql += "VALUES (?, ?) ";
      sql += "ON DUPLICATE KEY UPDATE option_name = ?, option_value = ?";

      const rs = await db.execute(sql, [optionName, options, optionName, options]);
      return rs;
    },
  });
};
